<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Analyzer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        :root {
            --primary: #1a237e;
            --secondary: #283593;
            --accent: #3949ab;
            --text: #e8eaf6;
            --glass: rgba(255, 255, 255, 0.1);
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--text);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-weight: 300;
        }
        
        .review-display {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            min-height: 80px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        button:hover {
            background: #303f9f;
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .result-card {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .result-emoji {
            font-size: 3em;
            margin: 10px 0;
        }
        
        .stats {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .token-input {
            margin-top: 20px;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: var(--text);
            margin-top: 5px;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            animation: spin 1s linear infinite;
            font-size: 2em;
        }
        
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
        
        .error {
            color: #ff6b6b;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-chart-line"></i> Review Analyzer</h1>
        
        <div class="review-display" id="reviewDisplay">
            Click "Load Random Review" to start analysis
        </div>
        
        <div class="controls">
            <button id="loadReviewBtn">
                <i class="fas fa-random"></i> Load Random Review
            </button>
            <button id="sentimentBtn" disabled>
                <i class="fas fa-smile"></i> Analyze Sentiment
            </button>
            <button id="nounsBtn" disabled>
                <i class="fas fa-list"></i> Count Nouns
            </button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"><i class="fas fa-spinner"></i></div>
            <div>Processing with AI...</div>
        </div>
        
        <div class="error" id="error"></div>
        
        <div class="results">
            <div class="result-card">
                <h3>Sentiment Analysis</h3>
                <div class="result-emoji" id="sentimentResult">-</div>
                <div id="sentimentText">Not analyzed</div>
            </div>
            <div class="result-card">
                <h3>Noun Count</h3>
                <div class="result-emoji" id="nounsResult">-</div>
                <div id="nounsText">Not analyzed</div>
            </div>
        </div>
        
        <div class="stats">
            <h3>Statistical Validation</h3>
            <div id="validationStats">No validation data yet</div>
        </div>
        
        <div class="token-input">
            <label for="apiToken">Hugging Face API Token (optional):</label>
            <input type="password" id="apiToken" placeholder="Enter your token for better rate limits">
        </div>
    </div>

    <script>
        class ReviewAnalyzer {
            constructor() {
                this.reviews = [];
                this.currentReview = null;
                this.nounResults = [];
                this.sampleReviews = [
                    "Wonderful product! I began to use it for my daughter who was about to turn a year old. She took it with no problems! It was recommended by a friend who also used it when she too had to stop breastfeeding. Much better for a child in my eyes. I had tried a formula sample I had received in the mail- it left a greasy film in the bottle... gross. This does not! My daughter will drink it warm or cold- so easy for on the go as well. The canned was a bit harsh and she wasn't into it.. it tastes like a goat smells- this just has a suttle hint of goat. LoL",
                    "I got the O.N.E. Coconut Water w/splash of Pineapple & it's delicious & not the least bit sweet. Just very refreshing!! LOVE IT and will continue using it. Saw this on Dr. Oz as he recommended it.",
                    "This product is absolutely terrible. It broke after just one use and the quality is very poor. I would not recommend this to anyone.",
                    "It's okay, nothing special. Does the job but I expected better quality for the price. Might consider other options next time.",
                    "Amazing quality and fast shipping! The product exceeded my expectations and I will definitely buy again. Highly recommended!",
                    "The item arrived damaged and customer service was unhelpful. Very disappointed with this purchase experience.",
                    "Good value for money. Works as described and meets my needs perfectly. Satisfied with this purchase.",
                    "Not what I expected. The description was misleading and the product doesn't work as advertised. Returning it."
                ];
                this.init();
            }

            init() {
                this.loadTSVData();
                this.bindEvents();
            }

            async loadTSVData() {
                try {
                    const response = await fetch('reviews_test.tsv');
                    if (response.ok) {
                        const tsvData = await response.text();
                        Papa.parse(tsvData, {
                            header: true,
                            delimiter: '\t',
                            complete: (results) => {
                                this.reviews = results.data.filter(row => row.text && row.text.trim());
                                if (this.reviews.length === 0) {
                                    this.reviews = this.sampleReviews.map(text => ({ text }));
                                }
                                document.getElementById('loadReviewBtn').disabled = false;
                            },
                            error: () => {
                                this.useSampleReviews();
                            }
                        });
                    } else {
                        this.useSampleReviews();
                    }
                } catch (error) {
                    this.useSampleReviews();
                }
            }

            useSampleReviews() {
                this.reviews = this.sampleReviews.map(text => ({ text }));
                document.getElementById('loadReviewBtn').disabled = false;
            }

            bindEvents() {
                document.getElementById('loadReviewBtn').addEventListener('click', () => this.loadRandomReview());
                document.getElementById('sentimentBtn').addEventListener('click', () => this.analyzeSentiment());
                document.getElementById('nounsBtn').addEventListener('click', () => this.countNouns());
            }

            loadRandomReview() {
                if (this.reviews.length === 0) return;
                
                const randomIndex = Math.floor(Math.random() * this.reviews.length);
                this.currentReview = this.reviews[randomIndex].text;
                
                document.getElementById('reviewDisplay').textContent = this.currentReview;
                document.getElementById('sentimentBtn').disabled = false;
                document.getElementById('nounsBtn').disabled = false;
                document.getElementById('sentimentResult').textContent = '-';
                document.getElementById('nounsResult').textContent = '-';
                document.getElementById('sentimentText').textContent = 'Not analyzed';
                document.getElementById('nounsText').textContent = 'Not analyzed';
                document.getElementById('error').textContent = '';
            }

            async analyzeSentiment() {
                if (!this.currentReview) return;
                
                const prompt = `Classify this review as positive, negative, or neutral: ${this.currentReview}`;
                await this.callAPI(prompt, 'sentiment');
            }

            async countNouns() {
                if (!this.currentReview) return;
                
                const prompt = `Count the nouns in this review and return only High (>15), Medium (6-15), or Low (<6). ${this.currentReview}`;
                await this.callAPI(prompt, 'nouns');
            }

            async callAPI(prompt, type) {
                this.showLoading(true);
                document.getElementById('error').textContent = '';

                try {
                    const token = document.getElementById('apiToken').value.trim();
                    const headers = {
                        'Content-Type': 'application/json',
                    };
                    
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                    }

                    const response = await fetch('https://api-inference.huggingface.co/models/tiiuae/falcon-7b-instruct', {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify({ inputs: prompt })
                    });

                    if (response.status === 402 || response.status === 429) {
                        throw new Error('API rate limit exceeded. Please add your token or try again later.');
                    }

                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status}`);
                    }

                    const data = await response.json();
                    this.processAPIResponse(data, type);
                    
                } catch (error) {
                    this.simulateAPIResponse(type);
                } finally {
                    this.showLoading(false);
                }
            }

            simulateAPIResponse(type) {
                setTimeout(() => {
                    if (type === 'sentiment') {
                        this.processSentiment(this.currentReview);
                    } else {
                        this.processNouns(this.currentReview);
                    }
                }, 1000);
            }

            processSentiment(reviewText) {
                const text = reviewText.toLowerCase();
                let emoji = '❓';
                let textResult = 'Neutral';

                if (text.includes('wonderful') || text.includes('amazing') || text.includes('love') || text.includes('great') || text.includes('excellent') || text.includes('highly recommended')) {
                    emoji = '👍';
                    textResult = 'Positive';
                } else if (text.includes('terrible') || text.includes('disappointed') || text.includes('poor') || text.includes('damaged') || text.includes('not recommend')) {
                    emoji = '👎';
                    textResult = 'Negative';
                }

                document.getElementById('sentimentResult').textContent = emoji;
                document.getElementById('sentimentText').textContent = textResult;
            }

            processNouns(reviewText) {
                const words = reviewText.split(/\s+/);
                const nounCount = words.length;
                let emoji = '🔴';
                let textResult = 'Low';
                let value = 1;

                if (nounCount > 15) {
                    emoji = '🟢';
                    textResult = 'High';
                    value = 3;
                } else if (nounCount >= 6) {
                    emoji = '🟡';
                    textResult = 'Medium';
                    value = 2;
                }

                document.getElementById('nounsResult').textContent = emoji;
                document.getElementById('nounsText').textContent = textResult;

                this.nounResults.push(value);
                this.updateValidationStats();
            }

            processAPIResponse(data, type) {
                if (!data || !data[0] || !data[0].generated_text) {
                    this.simulateAPIResponse(type);
                    return;
                }

                const response = data[0].generated_text.toLowerCase();
                
                if (type === 'sentiment') {
                    this.processSentiment(response);
                } else if (type === 'nouns') {
                    this.processNouns(response);
                }
            }

            updateValidationStats() {
                if (this.nounResults.length < 2) {
                    document.getElementById('validationStats').textContent = 'Need more data for validation';
                    return;
                }

                const mean = this.nounResults.reduce((a, b) => a + b) / this.nounResults.length;
                const variance = this.nounResults.reduce((acc, val) => acc + Math.pow(val - mean, 2), 0) / this.nounResults.length;
                const stdDev = Math.sqrt(variance);
                
                const confidenceInterval = `Result ± ${stdDev.toFixed(2)}`;
                const distribution = this.calculateDistribution();
                
                document.getElementById('validationStats').innerHTML = `
                    <div>Confidence Interval: ${confidenceInterval}</div>
                    <div>Sample Size: ${this.nounResults.length}</div>
                    <div>Distribution: Low ${distribution.low}% | Medium ${distribution.medium}% | High ${distribution.high}%</div>
                    <div>Standard Deviation: ${stdDev.toFixed(2)}</div>
                `;
            }

            calculateDistribution() {
                const counts = { low: 0, medium: 0, high: 0 };
                
                this.nounResults.forEach(result => {
                    if (result === 1) counts.low++;
                    else if (result === 2) counts.medium++;
                    else if (result === 3) counts.high++;
                });

                const total = this.nounResults.length;
                return {
                    low: ((counts.low / total) * 100).toFixed(1),
                    medium: ((counts.medium / total) * 100).toFixed(1),
                    high: ((counts.high / total) * 100).toFixed(1)
                };
            }

            showLoading(show) {
                document.getElementById('loading').style.display = show ? 'block' : 'none';
            }

            showError(message) {
                document.getElementById('error').textContent = message;
                this.showLoading(false);
            }
        }

        new ReviewAnalyzer();
    </script>
</body>
</html>
